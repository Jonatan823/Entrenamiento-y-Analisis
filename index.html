<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SLER Visual Lab - Nodo Bell Ville</title>
    <style>
        :root { --accent: #000; --bg: #fff; --sler-blue: #0ea5e9; }
        * { box-sizing: border-box; }
        body { font-family: monospace; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Lateral Derecha: Registro de Binomios */
        .results-sidebar { 
            width: 250px; border-left: 1px solid #eee; padding: 40px 20px; 
            order: 2; display: flex; flex-direction: column; gap: 20px;
        }
        .bin-entry { font-size: 13px; color: #999; line-height: 1.6; }
        .bin-entry.active { color: #000; font-weight: bold; }

        /* Área Central */
        .main-content { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 40px; }
        .header { width: 100%; max-width: 600px; border-bottom: 1px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
        
        .timers { display: flex; gap: 50px; margin-bottom: 30px; }
        .timer-box { text-align: center; width: 120px; }
        .timer-val { font-size: 28px; font-weight: bold; font-variant-numeric: tabular-nums; }
        .label { font-size: 10px; text-transform: uppercase; color: #666; letter-spacing: 1px; }

        .training-box { 
            width: 100%; max-width: 600px; height: 350px;
            padding: 20px; font-size: 20px; line-height: 1.7;
            font-weight: bold; background: #fff; display: none;
        }
        .sler-line { white-space: pre; display: block; }

        .controls { margin-top: 30px; }
        button { 
            padding: 15px 60px; cursor: pointer; font-family: monospace; font-weight: bold; 
            background: #000; color: #fff; border: none; font-size: 16px;
        }
        button:hover { background: var(--sler-blue); }
    </style>
</head>
<body>

    <main class="main-content">
        <div class="header">
            <span class="label">SLER LAB: NIVEL <span id="lvlDisplay">1</span></span>
        </div>

        <div class="timers">
            <div class="timer-box">
                <div class="label">ESTÁNDAR</div>
                <div id="timerStd" class="timer-val">0.000s</div>
            </div>
            <div class="timer-box" id="slerTimerCont" style="opacity: 0.1;">
                <div class="label">SLER</div>
                <div id="timerSler" class="timer-val">0.000s</div>
            </div>
        </div>

        <div id="exerciseBox" class="training-box"></div>

        <div class="controls">
            <button id="mainBtn" onclick="handleFlow()">Iniciar</button>
        </div>
    </main>

    <aside class="results-sidebar">
        <div class="label" style="margin-bottom: 10px;">BINOMIOS PARCIALES</div>
        <div id="bin-1" class="bin-entry">N1: ---</div>
        <div id="bin-2" class="bin-entry">N2: ---</div>
        <div id="bin-3" class="bin-entry">N3: ---</div>
        <div id="bin-4" class="bin-entry">N4: ---</div>
    </aside>

<script>
    let startTime, timerInterval;
    let currentLvl = 1;
    let mode = 'IDLE'; // IDLE, RUN_STD, WAIT_SLER, RUN_SLER
    const LIMITE = 45;

    const texts = [
        "La lectura tradicional implica un salto brusco al final de cada renglón impreso. El sistema visual se adapta.",
        "El desarrollo de la neurociencia aplicada permite optimizar los procesos de captura de información. Cada renglón demanda un esfuerzo muscular ciliar.",
        "Cuando el ojo llega al final de una línea común, se produce un salto sacádico de retorno forzado. Este movimiento es mecánico y no aporta datos.",
        "El algoritmo de entrenamiento final es técnico. Requiere concentración absoluta en voz alta. Observe cómo su cerebro procesa cada sílaba sin saltos."
    ];

    function tratarSignos(w, inv) {
        if (!inv) return w;
        let p = w.match(/^[.,;:]+/), s = w.match(/[.,;:]+$/);
        let base = w.replace(/^[.,;:]+|[.,;:]+$/g, '');
        return (s ? s[0] : '') + base + (p ? p[0] : '');
    }

    function ejecutarMotor(texto) {
        let mazo = texto.replace(/\s+/g, ' ').trim().split(' ');
        let res = "", par = false;
        while (mazo.length > 0) {
            let lin = "";
            while (mazo.length > 0 && (lin.length + mazo[0].length + (lin ? 1 : 0)) <= LIMITE) {
                lin += (lin ? " " : "") + mazo.shift();
            }
            if (par) {
                let inv = lin.split(' ').map(w => tratarSignos(w, true)).reverse().join(' ');
                let pad = " ".repeat(Math.max(0, LIMITE - inv.length));
                res += `<div class="sler-line">${pad}${inv}</div>`;
            } else {
                res += `<div class="sler-line">${lin}</div>`;
            }
            par = !par;
        }
        return res;
    }

    function handleFlow() {
        const btn = document.getElementById('mainBtn');
        const box = document.getElementById('exerciseBox');
        
        if (mode === 'IDLE') {
            mode = 'RUN_STD';
            box.innerText = texts[currentLvl-1];
            box.style.display = 'block';
            btn.innerText = "Detener";
            startClock('timerStd');
        } else if (mode === 'RUN_STD') {
            stopClock();
            mode = 'WAIT_SLER';
            box.style.display = 'none';
            btn.innerText = "Iniciar SLER";
            document.getElementById('slerTimerCont').style.opacity = "1";
        } else if (mode === 'WAIT_SLER') {
            mode = 'RUN_SLER';
            box.innerHTML = ejecutarMotor(texts[currentLvl-1]);
            box.style.display = 'block';
            btn.innerText = "Detener";
            startClock('timerSler');
        } else if (mode === 'RUN_SLER') {
            stopClock();
            updateSidebar();
            if (currentLvl < 4) {
                currentLvl++;
                resetState();
            } else {
                btn.innerText = "Finalizado";
                btn.disabled = true;
            }
        }
    }

    function startClock(id) {
        startTime = performance.now();
        timerInterval = setInterval(() => {
            document.getElementById(id).innerText = ((performance.now() - startTime) / 1000).toFixed(3) + "s";
        }, 10);
    }

    function stopClock() { clearInterval(timerInterval); }

    function updateSidebar() {
        const std = document.getElementById('timerStd').innerText;
        const sler = document.getElementById('timerSler').innerText;
        const entry = document.getElementById(`bin-${currentLvl}`);
        entry.innerHTML = `N${currentLvl}: STD ${std} | SLER ${sler}`;
        entry.classList.add('active');
    }

    function resetState() {
        mode = 'IDLE';
        document.getElementById('exerciseBox').style.display = 'none';
        document.getElementById('lvlDisplay').innerText = currentLvl;
        document.getElementById('timerStd').innerText = "0.000s";
        document.getElementById('timerSler').innerText = "0.000s";
        document.getElementById('slerTimerCont').style.opacity = "0.1";
        document.getElementById('mainBtn').innerText = "Iniciar";
    }
</script>
</body>
</html>
